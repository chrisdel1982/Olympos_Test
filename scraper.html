<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPSM Scraper</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; background: #f4f4f4; }
        h1 { color: #1a472a; border-bottom: 3px solid #ffd700; }
        textarea.input-area { width: 100%; height: 150px; font-family: monospace; padding: 10px; border: 2px solid #ccc; border-radius: 5px; }
        button { padding: 12px 25px; background: #1a472a; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1.1rem; width: 100%; margin-top: 10px; }
        button:hover { background: #2d5a3d; }
        .step { background: white; padding: 1.5rem; border-radius: 8px; margin-top: 2rem; display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .step textarea { width: 100%; height: 200px; margin-top: 10px; background: #fafafa; border: 1px solid #ddd; font-size: 0.9rem; }
        .error { color: #d32f2f; background: #ffebee; padding: 1rem; margin-top: 1rem; display: none; font-weight: bold; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>ğŸ¤– EPSM Scraper </h1>
    <div class="instruction">
        <strong>Î ÏÏ‚ Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÎ¹Ï‚:</strong>
        <ol>
            <li>Î Î®Î³Î±Î¹Î½Îµ ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î± Ï„Î·Ï‚ Î•Î Î£Îœ Î¼Îµ Ï„Î¿ Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î±.</li>
            <li>ÎšÎ¬Î½Îµ Î´ÎµÎ¾Î¯ ÎºÎ»Î¹Îº ÎºÎ¬Ï€Î¿Ï… ÎºÎµÎ½Î¬ ÏƒÏ„Î· ÏƒÎµÎ»Î¯Î´Î± ÎºÎ±Î¹ Ï€Î¬Ï„Î± <strong>"Î ÏÎ¿Î²Î¿Î»Î® ÎºÏÎ´Î¹ÎºÎ± ÏƒÎµÎ»Î¯Î´Î±Ï‚"</strong> (View Page Source).</li>
            <li>Î˜Î± Î±Î½Î¿Î¯Î¾ÎµÎ¹ Î¼Î¹Î± ÎºÎ±ÏÏ„Î­Î»Î± Î¼Îµ ÎºÏÎ´Î¹ÎºÎ±. Î Î¬Ï„Î± <strong>Ctrl + A</strong> (Î•Ï€Î¹Î»Î¿Î³Î® ÏŒÎ»Ï‰Î½) ÎºÎ±Î¹ Î¼ÎµÏ„Î¬ <strong>Ctrl + C</strong> (Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®).</li>
            <li>ÎˆÎ»Î± ÎµÎ´Ï ÎºÎ±Î¹ ÎºÎ¬Î½Îµ <strong>Î•Ï€Î¹ÎºÏŒÎ»Î»Î·ÏƒÎ· (Ctrl + V)</strong> ÏƒÏ„Î¿ ÎºÎ¿Ï…Ï„Î¯ Î±Ï€ÏŒ ÎºÎ¬Ï„Ï‰.</li>
            <li>Î Î¬Ï„Î± Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ <strong>"Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎšÏÎ´Î¹ÎºÎ±"</strong>.</li>
        </ol>
    </div>

    <textarea id="htmlInput" class="input-area" placeholder="Î•Ï€Î¹ÎºÏŒÎ»Î»Î·ÏƒÎ· ÎºÏÎ´Î¹ÎºÎ±..."></textarea>
    <button onclick="parseHTML()">ğŸš€ Î•ÏÏÎµÏƒÎ· ÎŸÎ¼Î¬Î´Ï‰Î½</button>

    <div id="error" class="error"></div>

    <div id="resultStep" class="step">
        <h3>âœ… Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±</h3>
        
        <p><strong>1. ÎŸÎ¼Î¬Î´ÎµÏ‚ (Î‘Î»Ï†Î±Î²Î·Ï„Î¹ÎºÎ¬):</strong></p>
        <textarea id="teamsOutput"></textarea>
        
        <p><strong>2. Î ÏÏŒÎ³ÏÎ±Î¼Î¼Î± (JSON):</strong></p>
        <textarea id="jsonOutput"></textarea>
    </div>

    <script>
        function parseHTML() {
            let rawHTML = document.getElementById('htmlInput').value;
            const errorDiv = document.getElementById('error');
            const resultStep = document.getElementById('resultStep');

            errorDiv.style.display = 'none';
            resultStep.style.display = 'none';

            if (!rawHTML.trim()) {
                showError("Î¤Î¿ ÎºÎ¿Ï…Ï„Î¯ ÎµÎ¯Î½Î±Î¹ Î¬Î´ÎµÎ¹Î¿!");
                return;
            }

            try {
                // 1. ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚: Î”Î¹Î±Î³ÏÎ±Ï†Î® script/style
                const parser = new DOMParser();
                const doc = parser.parseFromString(rawHTML, 'text/html');
                doc.querySelectorAll('script, style, link, meta, head, header, footer, nav').forEach(el => el.remove());
                
                // 2. ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® <br> ÏƒÎµ Î±Î»Î»Î±Î³Î® Î³ÏÎ±Î¼Î¼Î®Ï‚ (ÎšÎ¡Î™Î£Î™ÎœÎŸ Î³Î¹Î± Ï„Î·Î½ Î•Î Î£Îœ)
                let cleanText = doc.body ? doc.body.innerHTML : rawHTML;
                cleanText = cleanText.replace(/<br\s*\/?>/gi, '\n').replace(/<\/tr>/gi, '\n');
                
                const tempDiv = document.createElement("div");
                tempDiv.innerHTML = cleanText;
                let textContent = tempDiv.textContent || tempDiv.innerText || "";

                // 3. Î‘Î½Î¬Î»Ï…ÏƒÎ· Î“ÏÎ±Î¼Î¼Î®-Î“ÏÎ±Î¼Î¼Î®
                const lines = textContent.split('\n');
                const fixtures = [];
                const allTeams = new Set();
                
                let currentRound = 0;
                let currentMatches = [];
                let isReadingMatches = false; // "Î”Î¹Î±ÎºÏŒÏ€Ï„Î·Ï‚" Ï€Î¿Ï… Î±Î½Î¿Î¯Î³ÎµÎ¹ Î¼ÏŒÎ½Î¿ ÏŒÏ„Î±Î½ Î²ÏÎ¿ÏÎ¼Îµ Î‘Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ®

                lines.forEach(line => {
                    let text = line.trim();
                    if (!text) return;

                    // --- Î‘. Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚ Î‘Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ®Ï‚ ---
                    if (text.includes('Î‘Î“Î©ÎÎ™Î£Î¤Î™ÎšÎ—')) {
                        // Î‘Î½ ÎµÎ¯Ï‡Î±Î¼Îµ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ®, Ï„Î·Î½ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Ï…Î¼Îµ
                        if (currentRound > 0 && currentMatches.length > 0) {
                            fixtures.push({ round: currentRound, matches: [...currentMatches] });
                        }

                        const matchRound = text.match(/(\d+)Î·/);
                        if (matchRound) {
                            currentRound = parseInt(matchRound[1]);
                            isReadingMatches = true; // ÎÎµÎºÎ¹Î½Î¬Î¼Îµ Î½Î± Î´Î¹Î±Î²Î¬Î¶Î¿Ï…Î¼Îµ Î¼Î±Ï„Ï‚
                            currentMatches = [];
                            return; 
                        }
                    }

                    // --- Î’. Î‘Î½Î¬Î³Î½Ï‰ÏƒÎ· Î‘Î³ÏÎ½Î± (ÎœÏŒÎ½Î¿ Î±Î½ Î¿ Î´Î¹Î±ÎºÏŒÏ€Ï„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ Î±Î½Î¿Î¹Ï‡Ï„ÏŒÏ‚) ---
                    if (isReadingMatches) {
                        // Î‘Î½ Î· Î³ÏÎ±Î¼Î¼Î® Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Ï€Î±ÏÎ»Î± "-" Î® ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï Î¼Î¹ÎºÏÎ®, Î¼Î¬Î»Î»Î¿Î½ Ï„ÎµÎ»ÎµÎ¯Ï‰ÏƒÎ±Î½ Ï„Î± Î¼Î±Ï„Ï‚ Ï„Î·Ï‚ Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ®Ï‚
                        // Î® ÎµÎ¯Î½Î±Î¹ ÏƒÎºÎ¿Ï…Ï€Î¯Î´Î¹ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÏ„Î± Î¼Î±Ï„Ï‚.
                        if (!text.includes('-') || text.length < 5) {
                            // Î”ÎµÎ½ ÎºÎ»ÎµÎ¯Î½Î¿Ï…Î¼Îµ Ï„Î¿Î½ Î´Î¹Î±ÎºÏŒÏ€Ï„Î· Î±Î¼Î­ÏƒÏ‰Ï‚, Î³Î¹Î±Ï„Î¯ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÎºÎµÎ½Î® Î³ÏÎ±Î¼Î¼Î®.
                            // Î‘Î»Î»Î¬ Î´ÎµÎ½ Ï„Î¿ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ Ï‰Ï‚ Î¼Î±Ï„Ï‚.
                            return; 
                        }

                        // Î‘Î½Î¬Î»Ï…ÏƒÎ· ÎŸÎœÎ‘Î”Î‘ Î‘ - ÎŸÎœÎ‘Î”Î‘ Î’
                        const dashIndex = text.indexOf('-');
                        
                        let part1 = text.substring(0, dashIndex).trim();
                        let part2 = text.substring(dashIndex + 1).trim();

                        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎµÎ³ÎºÏ…ÏÏŒÏ„Î·Ï„Î±Ï‚ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½
                        if (part1.length < 2 || part2.length < 2) return;
                        if (part1 === 'Î“Î—Î Î•Î”ÎŸÎ¥Î§ÎŸÎ£' || part1.includes('Î£Ï‰Î¼Î±Ï„ÎµÎ¯Î¿')) return;
                        
                        // Î‘Î³Î½Î¿Î¿ÏÎ¼Îµ Ï„Î± Î¡Î•Î ÎŸ (Î® Ï„Î± ÎºÏÎ±Ï„Î¬Î¼Îµ Î±Î½ Î¸ÎµÏ‚, ÎµÎ´Ï Ï„Î± Î±Î³Î½Î¿Î¿ÏÎ¼Îµ Î³Î¹Î± Î½Î± Î¼Î· Î¼Ï€Î¿Ï…Î½ ÏƒÏ„Î¹Ï‚ ÎŸÎ¼Î¬Î´ÎµÏ‚)
                        if (part1.includes('Î¡Î•Î ÎŸ') || part2.includes('Î¡Î•Î ÎŸ')) return;

                        // Î•ÏÏÎµÏƒÎ· Î£ÎºÎ¿Ï (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Ï„Î·Ï‚ 2Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚)
                        let home = part1;
                        let away = part2;
                        let hScore = null, aScore = null;

                        // Î¨Î¬Ï‡Î½Î¿Ï…Î¼Îµ Î¼Î¿Ï„Î¯Î²Î¿ " 2 - 1" ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚
                        const scoreMatch = part2.match(/(\d+)\s*-\s*(\d+)$/);
                        if (scoreMatch) {
                            hScore = parseInt(scoreMatch[1]);
                            aScore = parseInt(scoreMatch[2]);
                            away = part2.replace(scoreMatch[0], '').trim();
                        } else {
                            // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î±Î½ Î­Ï‡ÎµÎ¹ Ï€Î±ÏÎ»Î± ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚
                            away = part2.replace(/-$/, '').trim();
                        }

                        // Î¤ÎµÎ»Î¹ÎºÏŒÏ‚ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚: Î‘Î½ Ï„Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± Î¼Î¿Î¹Î¬Î¶Î¿Ï…Î½ Î¼Îµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ­Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚
                        // Î‘Ï€Î¿ÎºÎ»ÎµÎ¯Î¿Ï…Î¼Îµ "ÎÎ­Î±", "Î¡ÎµÏ€Î¿ÏÏ„Î¬Î¶" Ï€Î¿Ï… Ï„Ï…Ï‡ÏŒÎ½ Î³Î»Î¯ÏƒÏ„ÏÎ·ÏƒÎ±Î½
                        const garbage = ['ÎÎ­Î±', 'Î¡ÎµÏ€Î¿ÏÏ„Î¬Î¶', 'Îš14', 'Îš15', 'Î”Î¥Î¤Î™ÎšÎŸÎ£', 'Î‘ÎÎ‘Î¤ÎŸÎ›Î™ÎšÎŸÎ£'];
                        if (garbage.some(g => home.includes(g) || away.includes(g))) return;

                        // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·
                        allTeams.add(home);
                        allTeams.add(away);
                        currentMatches.push({ home, away, homeScore: hScore, awayScore: aScore });
                    }
                });

                // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î±Ï‚ Î±Î³Ï‰Î½Î¹ÏƒÏ„Î¹ÎºÎ®Ï‚
                if (currentRound > 0 && currentMatches.length > 0) {
                    fixtures.push({ round: currentRound, matches: [...currentMatches] });
                }

                if (fixtures.length === 0) throw new Error("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î±Î³ÏÎ½ÎµÏ‚. Î’ÎµÎ²Î±Î¹ÏÏƒÎ¿Ï… ÏŒÏ„Î¹ Î¿ ÎºÏÎ´Î¹ÎºÎ±Ï‚ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î· Î»Î­Î¾Î· 'Î‘Î“Î©ÎÎ™Î£Î¤Î™ÎšÎ—'.");

                // --- Output ---
                const sortedTeams = Array.from(allTeams).sort();
                let teamsJs = "const TEAMS = [\n";
                sortedTeams.forEach(t => teamsJs += `    '${t}',\n`);
                teamsJs += "];";
                document.getElementById('teamsOutput').value = teamsJs;

                const jsonOutput = JSON.stringify(fixtures, null, 2);
                document.getElementById('jsonOutput').value = `"fixtures": ${jsonOutput}`;

                resultStep.style.display = 'block';

            } catch (err) {
                showError(err.message);
            }
        }

        function showError(msg) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerText = "âŒ " + msg;
            errorDiv.style.display = 'block';
        }
    </script>

</body>
</html>